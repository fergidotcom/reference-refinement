project_name: "Reference Refinement"
perspective_source: "claude_ai"
timestamp: "2025-11-10T00:30:00-07:00"

session_summary: |
  Major architectural enhancement to Mac Web session specifications: Instance reference system
  with RID versioning, universal expansion for multi-citation references, and iPad app filtering
  capabilities. This design ensures all additional manuscript citations receive proper human
  review while maintaining parent reference integrity.

work_completed:
  strategic_architecture:
    - "Designed RID versioning system: Parent (42) → Instances (42.1, 42.2, 42.3)"
    - "Defined instance reference as always unfinalized (requires human review)"
    - "Universal instance expansion: Both finalized AND unfinalized parents get instances"
    - "Specified iPad app enhancement: New 'Instances' filter with parent linking"
    
  session_package_enhancements:
    - "Updated MAC_CLAUDE_WEB_SESSION_PACKAGE.md with instance architecture"
    - "Expanded Phase 3: Differential processing for parent vs instance creation"
    - "Enhanced Phase 4: Universal instance expansion with RID versioning"
    - "Added iPad App Enhancement section with detailed specifications"
    - "Updated all deliverable formats to reflect parent-instance structure"
  
  documentation_updates:
    - "Data structure framework: Parent reference + instance reference schemas"
    - "Filter logic specifications for iPad app"
    - "CSS styling for instance reference visual differentiation"
    - "Quality validation rules for instance uniqueness"
    - "Success metrics updated to reflect instance architecture"

current_state:
  status: "architecture_defined_implementation_ready"
  
  active_priorities:
    - "Mac Web: Execute comprehensive manuscript analysis with instance expansion"
    - "Mac Code: Implement iPad app v17.0 with instance filtering"
    - "User: Review architectural decision for approval before implementation"

  key_architectural_decisions:
    instance_reference_system:
      decision: "Instance references always created as unfinalized, even from finalized parents"
      rationale: |
        Even when parent reference is perfect (finalized), each additional manuscript citation
        occurs in different context and deserves separate human review to ensure secondary URL
        and relevance text appropriately match that specific usage. Context-dependent quality
        requires human judgment, not automatic inheritance from parent.
      
      benefits:
        - "Quality control: Human validates context-specific selections"
        - "Flexibility: Can finalize instances independently as reviewed"
        - "Safety: No assumption that parent quality transfers to different contexts"
        - "Workflow: Clear review queue of unfinalized instances in iPad app"
    
    rid_versioning_system:
      decision: "Parent reference keeps original RID, instances get parent_rid.instance_number"
      format: "C1-042 (parent) → C1-042.1, C1-042.2, C1-042.3 (instances)"
      rationale: |
        Clear parent-child relationship visible in RID itself. Preserves original reference
        numbering while allowing unlimited instance expansion. Sortable, filterable, and
        human-readable.
      
      implementation:
        - "Parent reference: Existing RID unchanged"
        - "Instance references: Append .1, .2, .3 to parent RID"
        - "parent_rid field: Links instance back to parent"
        - "instance_number field: Sequential numbering within parent"
    
    universal_instance_expansion:
      decision: "ALL multi-citation references get instance expansion, regardless of finalized status"
      scope: "Finalized parents AND unfinalized parents with 2+ manuscript citations"
      rationale: |
        Comprehensive representation of manuscript citation usage requires capturing all
        occurrences. Finalized parent preserves proven quality. Unfinalized instances enable
        context-specific review and improvement. No citation left unrepresented.
      
      workflow:
        finalized_parents:
          - "Parent reference: Preserved exactly (no changes)"
          - "Instance references: Created as unfinalized for each additional citation"
          - "Primary URL: Shared from parent (proven quality)"
          - "Secondary URL: New context-specific selection (requires review)"
          - "Relevance text: Instance-specific based on manuscript context"
        
        unfinalized_parents:
          - "Parent reference: Enhanced with better URLs and relevance text"
          - "Parent status: Remains unfinalized (needs review)"
          - "Instance references: Created as unfinalized for additional citations"
          - "All components: Apply discovered quality criteria"
    
    ipad_app_enhancement:
      decision: "Add 'Instances' filter to enable focused review of instance references"
      ui_components:
        - "Filter checkbox: Show/Hide instances"
        - "Instance badge: Visual indicator on reference cards"
        - "Parent link: Navigation from instance to parent"
        - "Counter: Display count of instance references"
        - "Styling: Purple theme for instance references"
      
      rationale: |
        User needs efficient workflow to review ~150-300 new instance references. Filtering
        enables focused review sessions. Parent linking provides context. Visual differentiation
        prevents confusion between parent and instance references.
      
      filter_combinations:
        - "All references: Default view with everything"
        - "Instances only: Focus on new instances needing review"
        - "Unfinalized instances: Subset of instances requiring attention"
        - "Hide instances: Traditional view of parent references only"

awaiting_input:
  from_user:
    - question: "Approve instance reference architecture before Mac Web implementation?"
      urgency: "HIGH"
      context: "Architectural decision affects ~6-10 hours of Web analysis work"
      decision_points:
        - "Instance references always unfinalized (even from finalized parents)"
        - "RID versioning format (42 → 42.1, 42.2)"
        - "Universal expansion for all multi-citation references"
        - "iPad app v17.0 enhancement with instance filtering"
    
    - question: "Provide 'Caught in the Act' manuscript to Mac Web for analysis?"
      urgency: "HIGH"
      blocks: "Mac Web cannot start Phase 1 citation mapping without manuscript"
      format: "DOCX format without reference URLs preferred"
  
  from_mac_web:
    - "Confirmation of architecture understanding before starting analysis"
    - "Any clarifications on RID versioning or instance flag structure"
    - "Manuscript file receipt and initial parsing results"
  
  from_mac_code:
    - "Confirmation of iPad app enhancement scope"
    - "Estimated implementation time for v17.0 updates"
    - "Any questions about filter logic or UI specifications"

architecture_specifications:
  data_structures:
    parent_reference:
      fields:
        reference_id: "Original RID (e.g., 'C1-042')"
        finalized: "bool - Preserved from original status"
        primary_url: "str - Preserved or enhanced depending on parent status"
        secondary_url: "str - Preserved or enhanced depending on parent status"
        relevance_text: "str - Preserved or enhanced depending on parent status"
        source: "'ORIGINAL' or 'WEB_ENHANCED'"
        batch_version: "str - Original or 'v17.0_WEB_ENHANCED'"
    
    instance_reference:
      fields:
        reference_id: "str - RID with instance number (e.g., 'C1-042.1')"
        parent_rid: "str - Link to parent (e.g., 'C1-042')"
        instance_number: "int - Sequential within parent (1, 2, 3...)"
        finalized: "bool - ALWAYS false (requires human review)"
        is_instance: "bool - ALWAYS true (enables filtering)"
        manuscript_context: "str - Full surrounding text (2-3 paragraphs)"
        context_purpose: "str - evidence/background/critique/comparison"
        primary_url: "str - Same as parent (shared source material)"
        secondary_url: "str - UNIQUE (different from parent and other instances)"
        relevance_text: "str - Instance-specific based on context"
        source: "'WEB_CREATED'"
        batch_version: "'v17.0'"
  
  validation_rules:
    instance_uniqueness:
      - "No duplicate secondary URLs within parent + all instances"
      - "Each instance has unique context and relevance text"
      - "All instances share parent's primary URL"
      - "RID versioning properly formatted (parent.instance_number)"
    
    quality_criteria:
      - "Instance secondary URLs meet finalized quality standards"
      - "Instance relevance text reflects actual manuscript usage"
      - "Instance context extracted accurately from manuscript"
      - "All instances flagged correctly (finalized=false, is_instance=true)"
  
  ipad_app_implementation:
    files_to_modify:
      - "index.html - Main app file"
    
    code_sections:
      filter_configuration: "Add instances: true to filters object"
      apply_filters_function: "Add instance filter logic"
      render_reference_card: "Add instance badge and parent link"
      update_filter_counts: "Add instance counter"
      css_styles: "Add .instance-reference and .instance-badge styles"
    
    version_update:
      from: "v16.10"
      to: "v17.0"
      reason: "Major feature: Instance reference management"

next_steps:
  immediate_user_actions:
    - "Review and approve instance reference architecture"
    - "Provide 'Caught in the Act' manuscript to Mac Web"
    - "Decide: Mac Web start immediately or await user testing feedback?"
  
  immediate_mac_web_actions:
    - "Receive manuscript and decisions.txt"
    - "Confirm architecture understanding"
    - "Begin Phase 1: Citation instance mapping"
    - "Proceed through 5-phase comprehensive analysis"
    - "Deliver PERFECTED_decisions.txt with instances"
  
  immediate_mac_code_actions:
    - "Implement iPad app v17.0 enhancement"
    - "Add instance filtering and display features"
    - "Test with sample instance references"
    - "Deploy updated app to production"
    - "Await PERFECTED_decisions.txt from Web for full testing"
  
  coordination_sequence:
    1: "User approves architecture and provides manuscript"
    2: "Mac Web executes comprehensive analysis (6-10 hours)"
    3: "Mac Code implements iPad app enhancement (1-2 hours)"
    4: "Web delivers PERFECTED_decisions.txt"
    5: "Code tests iPad app with real instance references"
    6: "User reviews instance references in enhanced iPad app"
    7: "User finalizes instances individually as reviewed"

expected_outcomes:
  perfected_decisions_txt:
    parent_references: "288 (preserved or enhanced)"
    instance_references: "~150-300 new (estimate 1.5-2 citations per reference average)"
    total_entries: "~450-600 references"
    finalized_parents: "~230-250 (preserved from original)"
    unfinalized_total: "~190-350 (enhanced parents + all instances)"
    
  ipad_app_v17:
    new_features:
      - "Instance reference filtering"
      - "Visual differentiation (purple theme)"
      - "Parent reference linking"
      - "RID versioning display"
      - "Instance counter"
    
    user_workflow:
      - "Filter to show instances only"
      - "Review instance context and URLs"
      - "Navigate to parent reference for comparison"
      - "Finalize instances individually"
      - "Track progress via counter"
  
  production_framework:
    automated_capabilities:
      - "Citation instance mapping from manuscript"
      - "Quality pattern extraction from finalized references"
      - "Context-aware relevance text generation"
      - "Context-matched secondary URL selection"
      - "Instance reference creation with RID versioning"
    
    human_review_boundaries:
      - "All instance references require finalization"
      - "Context-specific secondary URL confirmation"
      - "Relevance text accuracy validation"
      - "Edge cases and judgment calls"

quality_assurance:
  instance_creation_checklist:
    - "✓ Parent reference preserved or enhanced appropriately"
    - "✓ Instance RID formatted correctly (parent.instance_number)"
    - "✓ Instance flagged as unfinalized (finalized=false)"
    - "✓ Instance flagged as instance (is_instance=true)"
    - "✓ Parent RID link included (parent_rid field)"
    - "✓ Manuscript context extracted accurately"
    - "✓ Context purpose identified correctly"
    - "✓ Relevance text instance-specific (not copy of parent)"
    - "✓ Primary URL matches parent exactly"
    - "✓ Secondary URL unique (different from parent and other instances)"
    - "✓ Secondary URL meets quality criteria"
    - "✓ All metadata fields populated correctly"
  
  ipad_app_testing_checklist:
    - "✓ Instance filter toggles correctly"
    - "✓ Instance badge displays on cards"
    - "✓ Instance counter shows accurate count"
    - "✓ Parent link navigates correctly"
    - "✓ RID versioning displays properly (42.1, 42.2)"
    - "✓ Purple styling applied to instance cards"
    - "✓ Filter combinations work correctly"
    - "✓ All instances appear in unfinalized filter"

risk_assessment:
  instance_architecture:
    risk: "LOW"
    rationale: "Conservative approach - requires human review for all instances"
    mitigation: "User validates each instance individually, no automatic finalization"
  
  mac_web_analysis:
    risk: "MEDIUM"
    rationale: "Complex 5-phase analysis, 6-10 hours work, 1250-1900 searches"
    mitigation: "Detailed specifications, phased approach, quality validation at each phase"
  
  ipad_app_enhancement:
    risk: "LOW"
    rationale: "Straightforward UI enhancement, well-specified"
    mitigation: "Testing checklist, incremental deployment"

project_health:
  momentum: "HIGH - Clear architecture, ready for implementation"
  blockers: "User approval and manuscript provision (high priority, low effort)"
  next_milestone: "PERFECTED_decisions.txt with instance references"
  timeline: "2-3 weeks to complete analysis, enhancement, and user review of instances"

coordination_notes:
  - "Mac Web has comprehensive session package with all specifications"
  - "Mac Code has detailed iPad app enhancement requirements"
  - "Clear separation: Web creates instances, Code enables review workflow"
  - "User approval gate before starting (architecture decision)"
  - "Manuscript provision gate before Phase 1 (citation mapping)"

documentation_status:
  session_package: "✅ Complete - MAC_CLAUDE_WEB_SESSION_PACKAGE.md"
  checkpoint: "✅ Complete - ReferenceRefinementClaudePerspective.yaml"
  architecture_specs: "✅ Complete - Included in session package"
  ipad_app_specs: "✅ Complete - Included in session package"
  testing_procedures: "✅ Complete - Checklists in checkpoint"
